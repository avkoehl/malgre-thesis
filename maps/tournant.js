var preIncorporation = 
{"type":"FeatureCollection", "features":
  [
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Born in Strasbourg", "date": "1926-04-01", "page":"15", "country": "France", "city": "Strasbourg"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.48, 48.43]}, "properties": {"desc": "Evacuates to Goxwiller in anticipation of war, many other evacuated from Strasbourg", "date": "1939-09-03", "page": "27", "country": "France", "city": "Goxwiller"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Father mobilized into French army", "date": "1939-09-05", "page":"31", "country": "France", "city": "Strasbourg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.86, 47.64]}, "properties": {"desc": "Moves with mother to Belfort, leaving Alsace but staying close to grandparents", "date": "1939-09-27", "page":"38", "country": "France", "city": "Belfort"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [4.85, 46.78]}, "properties": {"desc": "Leave for Chalon-sur-Saone, as the germans expected to arrive in Belfort within days" , "date": "1940-06-17", "page":"56", "country": "France", "city": "Chalon-sur-Saone"}},
 	
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Return to Strasbourg, now part of Germany" , "date": "1940-10-15", "page":"65", "country": "France", "city": "Strasbourg"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Forced to join Hitler Youth" , "date": "1941-01-04", "page":"70", "country": "France", "city": "Strasbourg"}}
  ]
};

var Incorporation =
{"type":"FeatureCollection", "features":
  [
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Incorporated into the RAD" , "date": "1943-03", "page":"85", "country": "France", "city": "Strasbourg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.94, 49.03]}, "properties": {"desc": "Military preperation training in Wissembourg" , "date": "1943-06-14", "page":"86", "country": "France", "city": "Wissembourg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.77, 51.23]}, "properties": {"desc": "Military preperation in Dusseldorf" , "date": "1943-12", "page":"93", "country": "Germany", "city": "Dusseldorf"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Incorporated into the Wehrmacht" , "date": "1944-02-17", "page":"100", "country": "France", "city": "Strasbourg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [9.48, 51.31]}, "properties": {"desc": "Sent with unit to Kassel" , "date": "1944-03-01", "page":"100", "country": "Germany", "city": "Kassel"}},
 
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [13.73, 51.05]}, "properties": {"desc": "Returns to unit now in Dresden", "date": "1944-04-15", "page":"101", "country": "Germany", "city": "Dresden"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [11.57, 49.95]}, "properties": {"desc": "Incorporated into a unit in charge of transmissions and communications" , "date": "1944-04-15", "page":"101", "country": "Germany", "city": "Bayreuth"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [11.08, 49.43]}, "properties": {"desc": "Oath of Loyalty ceremony where remains silent" , "date": "1944-06-06", "quote": "Lorsqu'enfin retentit a notre attention l'ordre du 'Reposez Armes' qui marquait la fin de la ceremonie, j'eprouvai un sentiment de soulagement extraordinaire. Je n'avais rien jure au Fuhrer et n'avais trahi ni le drapeau francais ni le drapeau scout. Aujourd'hui encore, plus d'un demi-siecle apres, j'en eprouve une legitime fierte.", "page":"55", "country": "Germany", "city": "Nuremberg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [0.17, 48.88]}, "properties": {"desc": "D-Day" , "date": "1944-06-14", "country": "France", "city": "Normandy"}}
  ]
};

var SS = 
{"type":"FeatureCollection", "features":
  [
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [14.43, 50.08]}, "properties": {"desc": "Sent to Prague with communications unit" , "date": "1944-07-19", "page":"107", "country": "Czech-Republic", "city": "Prague"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [14.43, 50.08]}, "properties": {"desc": "Integrated into RSHA (Reich Main Security Office) and SS mobile communications unit" , "date": "1944-07-21", "page":"109", "country": "Czech-Republic", "city": "Prague"}},

 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [9.20, 48.89]}, "properties": {"desc": "First mission as SS" , "date": "1944-08-01", "page":"107", "country": "Germany", "city": "Ludwigsburg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [13.73, 51.05]}, "properties": {"desc": "Sent to reinforce infrantry unit in Poland but stops trip in Dresden due to complications from Scarlet Fever" , "date": "1944-08-20", "page":"110", "country": "Germany", "city": "Dresden"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [52.52, 13.41]}, "properties": {"desc": "rejoins RSHA headquarters" , "date": "1944-09-10", "page":"107", "country": "Germany", "city": "Berlin"}}
  ]
};



var bBulge = 
{"type":"FeatureCollection", "features":
  [
  	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [52.52, 13.41]}, "properties": {"desc": "Sent West in preperation of Counteroffensive near Ardennes" , "date": "1944-12-09", "page":"114", "country": "Germany", "city": "Berlin"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.79, 50.66]}, "properties": {"desc": "Arrives in Euskirchen near Cologne" , "date": "1944-12-10", "page":"115", "country": "Germany", "city": "Euskirchen"}},

 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [11.50, 51.64]}, "properties": {"desc": "Father sent to concentration camp" , "date": "1944-12-10", "page":"115", "country": "Germany", "city": "Hettstedt"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.48, 50.53]}, "properties": {"desc": "Part of 300 man mobile transmission unit attached to SS armoured division" , "date": "1944-12-14", "page":"115", "country": "Germany", "city": "Schleiden"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.75, 49.51]}, "properties": {"desc": "Further positioning in preperation for counter attack" , "date": "1944-12-20", "page":"119", "country": "Germany", "city": "Losheim"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.13, 50.28]}, "properties": {"desc": "Joins attack on St Vith" , "date": "1944-12-21", "page":"122", "country": "Belgium", "city": "St Vith"}},

 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [5.79, 50.13]}, "properties": {"desc": "Stationed in Houffalize, 20km from Bastogne" , "date": "1944-12-31", "page":"125", "country": "Luxembourg", "city": "Huffalize"}}
  
  ]
};

var bBerlin = 
{"type":"FeatureCollection", "features":
  [
  {"type": "Feature", "geometry": {"type": "Point", "coordinates": [52.52, 13.41]}, "properties": {"desc": "Return to RSHA HQ once healthy" , "date": "1945-03-20", "page":"143", "country": "Germany", "city": "Berlin"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [52.52, 13.41]}, "properties": {"desc": "Soviets arrive in Berlin" , "quote": "Chacun de nous, isole ou refroupe par petites unites de quelques hommes, n'avait plus qu'un seul objectif: sauver sa peau", "date": "1945-04-26", "page":"145", "country": "Germany", "city": "Berlin"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [52.52, 13.41]}, "properties": {"desc": "Facing Russian machine gun near Wilhelmstrasse" , "quote" : "je le retrouvai mort, atteint d'une balle en plein gorge. Il s'etait effondre sanse le moindre cri. Boulverse et pris de peur, je rejoignis a la hate mes deux camarades au rez-de-chaussez", "date": "1945-04-27", "page":"149", "country": "Germany", "city": "Berlin"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [52.52, 13.41]}, "properties": {"desc": "Fighting in streets of Berlin" , "quote": "Qui pouvait encore raisonnablement esperer sortir vivant de ce Berlin qui n'etait plus que ruines, feu et sang? Ou la mort etait omnipresente, decidee a refuser a quiconque la moindre possibilite de lui echappe.", "date": "1945-04-28", "page":"151", "country": "Germany", "city": "Berlin"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [52.52, 13.41]}, "properties": {"desc": "Captured by Russians" , "date": "1945-04-29", "page":"154", "country": "Germany", "city": "Berlin"}}
  
  ]
};

var retour = 
{"type":"FeatureCollection", "features":
  [
   	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [13.57, 52.69]}, "properties": {"desc": "In prisoner of war camp" , "date": "1945-05-05", "page":"154", "country": "Germany", "city": "Bernau"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [10.78, 52.42]}, "properties": {"desc": "In American prisoner of war camp on way to France" , "date": "1945-06-20", "page":"161", "country": "Germany", "city": "Wolfsburg"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [10.78, 52.42]}, "properties": {"desc": "Train en route to France" , "date": "1945-07-01", "page":"165", "country": "Germany", "city": "Wolfsburg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [5.69, 50.85]}, "properties": {"desc": "Stop 1" , "date": "1945-07-01", "page":"170", "country": "Netherlands", "city": "Maastricht"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [5.58, 50.63]}, "properties": {"desc": "Stop 2" , "date": "1945-07-01", "page":"170", "country": "Belgium", "city": "Liege"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [4.87, 50.47]}, "properties": {"desc": "Stop 3" , "quote": "C'etait une atmosphere indescritible, faite de joie et d'emotion, ne laissant aucun de nous indifferent. Nous etions fetes et acceuillis tels des heros revenant de je ne sais quelles fantastiques aventures." , "date": "1945-07-01", "page":"165", "country": "Belgium", "city": "Namur"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [4.44, 50.41]}, "properties": {"desc": "Stop 4" ,  "date": "1945-07-01", "page":"171", "country": "Belgium", "city": "Charleroi"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [4.10, 50.30]}, "properties": {"desc": "Finally in France, dealing with administration" ,  "date": "1945-07-01", "page":"173", "country": "France", "city": "Jeumont"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Returned to Strasbourg" ,  "date": "1945-07-08", "page":"176", "country": "France", "city": "Strasbourg"}}
  ]
};

var genEvents = 
{"type":"FeatureCollection", "features":
  [
   	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Alsatians born between 1909-1911 incorporated by force into Wehrmacht" , "date": "1942-08-25", "page":"79", "country": "France", "city": "Strasbourg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [2.35, 48.85]}, "properties": {"desc": "German soldiers march on the Champs Elysees" , "date": "1940-06-14", "page":"55", "country": "France", "city": "Paris"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [4.85, 46.78]}, "properties": {"desc": "German army arrives in Chalon-sur-Saone" , "date": "1940-06-19", "page":"60", "country": "France", "city": "Chalon-sur-Saone"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Strasbourg Liberated by General Leclerc, no more communications with family" , "date": "1944-11-23", "page":"113", "country": "France", "city": "Strasbourg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [21.37, 54.07]}, "properties": {"desc": "20 July Plot" , "date": "1944-07-20", "page":"107", "country": "Poland", "city": "Ketrzyn"}},

  {"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.25, 48.45]}, "properties": {"desc": "Struthof concentration camp" , "date": "1941", "end": "1944", "quote":"Arretes, tortures, deportes, ils connurent, pour la plupart, la dure realite des camps de concentration allemenads et notamment celui du Struthof, ce sinistre camp d'extermination ... beaucoup d'entre eux [Alsatians attempting to escape incorporation] y laisserent leur vie. De plus, il etait frequent d'apprendre que les epouses ou les proches parents de ces 'traitres' ... avaient ete, eux aussi, arretes, tortures, et deportes.", "page":"81", "country": "France", "city": "Struthof"}}

  ]
};

var airRaid = 
{"type":"FeatureCollection", "features":
  [
   	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.86, 47.63]}, "properties": {"desc": "German aerial bombardment of train station", "date": "1940-05-10", "page":"53", "country": "France", "city": "Belfort"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [8.67, 50.58]}, "properties": {"desc": "Severe bombing on route to Kassel" , "date": "1944-03", "page":"100", "country": "Germany", "city": "Gleissen"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [5.92, 50.11]}, "properties": {"desc": "Wounded in bomb raid" , "date": "1945-01-03", "page":"131", "country": "Luxembourg", "city": "Hachiville"}},

  	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.13, 50.28]}, "properties": {"desc": "Heavy allied bombardment of St Vith" , "date": "1944-12-23", "page":"124", "country": "Belgium", "city": "St Vith"}}

  ]
};

var hospital = 
{"type":"FeatureCollection", "features":
  [
   	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [11.19, 48.89]}, "properties": {"desc": "Transfered to military hospital in Eichstatt" , "date": "1944-08-21", "end": "1944-09-09", "page":"111", "country": "Germany", "city": "Eichstatt"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.00, 50.12]}, "properties": {"desc": "In field hospital" , "date": "1945-01-03", "end": "1945-01-04", "page":"131", "country": "Luxembourg", "city": "Trois Vierges"}},
	
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [6.42, 50.21]}, "properties": {"desc": "Trasnfered to military hispital" , "date": "1945-01-04", "end":"1945-01-05", "page":"132", "country": "Germany", "city": "Prum"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [11.56, 51.51]}, "properties": {"desc": "Again trasnfered to another hospital" , "quote": "Le souvenir de l'une d'elles ne m'a jamais quitte. Aujourd'hui encore, si longtemps apres, il m'arrive d'y penser. C'etait Soeur Elizabeth. Une grande et belle fille d'environ vingt ou vingt cinq ans... Nous bavardions de tout et de rien. Sa presence m'etait presque devenue indispensable.", "date": "1945-01-06", "end":"1945-02-13", "page":"134", "country": "Germany", "city": "Eisleben"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [9.48, 51.31]}, "properties": {"desc": "Sick with Scarlet Fever" , "date": "1944-03-01", "end":"1944-03-02", "page":"101", "country": "Germany", "city": "Kassel"}},
	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [9.86, 51.34]}, "properties": {"desc": "Transferred to Witzenhausen military hospital" , "date": "1944-03-03", "end": "1944-03-31", "page":"101", "country": "Germany", "city": "Witzenhausen"}},

 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [7.75, 48.57]}, "properties": {"desc": "Convalescence permission to return to Strasbourg" , "date": "1944-04-01", "end":"1944-04-14", "page":"101", "country": "France", "city": "Strasbourg"}},
 	{"type": "Feature", "geometry": {"type": "Point", "coordinates": [11.51, 51.64]}, "properties": {"desc": "Allowed to visit father in camp" , "date": "1945-02-14", "end": "1945-02-15",	"page":"136", "country": "Germany", "city": "Hettstedt"}},
  ]
};


  var getIntervalH = function (feature) {
    return {
      start: new Date (feature.properties.date),
      end: new Date (feature.properties.end)
    };
  };
  var getInterval = function (feature) {
	date = new Date (feature.properties.date);
	incDate = new Date (feature.properties.date);
	incDate = incDate.setDate(incDate.getDate() + 5);
    return {
      start: date,
      end: incDate
    };
  };
    var getIntervalG = function (feature) {
	date = new Date (feature.properties.date);
	incDate = new Date (feature.properties.date);
	incDate = incDate.setMonth(incDate.getMonth() + 1);
    return {
      start: date,
      end: incDate
    };
  };
  var hospitals = L.timeline(hospital, {
    getInterval: getIntervalH,
    waitToUpdateMap: true,
	pointToLayer: function(hospital, latlng){
            return L.circleMarker(latlng, {
              color: "#00ff00",
              fillColor: "#00ff00",
			  fillOpacity: "1"
            }).bindPopup(hospital.properties.date + "<br>" +hospital.properties.desc + "<br>" +hospital.properties.quote + "<br> page: " + hospital.properties.page + "<br> city: " +hospital.properties.city + "<br> country: " +hospital.properties.country).openPopup();
		}
  });

    var airRaids = L.timeline(airRaid, {
    getInterval: getIntervalG,
    waitToUpdateMap: true,
	pointToLayer: function(airRaid, latlng){
            return L.circleMarker(latlng, {
              color: "#ff0000",
              fillColor: "#ff0000",
			  fillOpacity: "1"
            }).bindPopup(airRaid.properties.date + "<br>" +airRaid.properties.desc + "<br>" +airRaid.properties.quote + "<br> page: " +airRaid.properties.page + "<br> city: " +airRaid.properties.city + "<br> country: " +airRaid.properties.country).openPopup();
		}
  });
    var events = L.timeline(genEvents, {
    getInterval: getIntervalG,
    waitToUpdateMap: true,
	pointToLayer: function(genEvents, latlng){
            return L.circleMarker(latlng, {
              color: "#f4a460",
              fillColor: "#f4a460",
			  fillOpacity: "1"
            }).bindPopup(genEvents.properties.date + "<br>" +genEvents.properties.desc + "<br>" +genEvents.properties.quote + "<br> page: " +genEvents.properties.page + "<br> city: " +genEvents.properties.city + "<br> country: " +genEvents.properties.country).openPopup();
		}
  });
  
  
    var pre = L.timeline(preIncorporation, {
    getInterval: getIntervalG,
    waitToUpdateMap: true,
	pointToLayer: function(preIncorporation, latlng){
            return L.circleMarker(latlng, {
              color: "#0000ff",
              fillColor: "#0000ff",
			  fillOpacity: "1"
            }).bindPopup(preIncorporation.properties.date + "<br>" +preIncorporation.properties.desc + "<br>" +preIncorporation.properties.quote + "<br> page: " +preIncorporation.properties.page + "<br> city: " +preIncorporation.properties.city + "<br> country: " +preIncorporation.properties.country).openPopup();
		}
  });
    var post = L.timeline(Incorporation, {
    getInterval: getIntervalG,
    waitToUpdateMap: true,
	pointToLayer: function(Incorporation, latlng){
            return L.circleMarker(latlng, {
              color: "#0000ff",
              fillColor: "#0000ff",
			  fillOpacity: "1"
            }).bindPopup(Incorporation.properties.date + "<br>" +Incorporation.properties.desc + "<br>" +Incorporation.properties.quote + "<br> page: " +Incorporation.properties.page + "<br> city: " +Incorporation.properties.city + "<br> country: " +Incorporation.properties.country).openPopup();
		}
  });

      var ss = L.timeline(SS, {
    getInterval: getIntervalG,
    waitToUpdateMap: true,
	pointToLayer: function(SS, latlng){
            return L.circleMarker(latlng, {
              color: "#0000ff",
              fillColor: "#0000ff",
			  fillOpacity: "1"
            }).bindPopup(SS.properties.date + "<br>" +SS.properties.desc + "<br>" +SS.properties.quote + "<br> page: " +SS.properties.page + "<br> city: " +SS.properties.city + "<br> country: " +SS.properties.country).openPopup();
		}
  });

        var bulge = L.timeline(bBulge, {
    getInterval: getIntervalG,
    waitToUpdateMap: true,
	pointToLayer: function(bBulge, latlng){
            return L.circleMarker(latlng, {
              color: "#0000ff",
              fillColor: "#0000ff",
			  fillOpacity: "1"
            }).bindPopup(bBulge.properties.date + "<br>" +bBulge.properties.desc + "<br>" +bBulge.properties.quote + "<br> page: " +bBulge.properties.page + "<br> city: " +bBulge.properties.city + "<br> country: " +bBulge.properties.country).openPopup();
		}
  });
        var bberlin = L.timeline(bBerlin, {
    getInterval: getIntervalG,
    waitToUpdateMap: true,
	pointToLayer: function(bBerlin, latlng){
            return L.circleMarker(latlng, {
              color: "#0000ff",
              fillColor: "#0000ff",
			  fillOpacity: "1"
            }).bindPopup(bBerlin.properties.date + "<br>" +bBerlin.properties.desc + "<br>" +bBerlin.properties.quote + "<br> page: " +bBerlin.properties.page + "<br> city: " +bBerlin.properties.city + "<br> country: " +bBerlin.properties.country).openPopup();
		}
  });
